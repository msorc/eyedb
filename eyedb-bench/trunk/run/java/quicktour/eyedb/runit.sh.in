#!/bin/bash
top_srcdir=@top_srcdir@
top_builddir=@top_builddir@
EYEDB_JAR=@EYEDB_JAR@
JAVA=@JAVA@

EYEDB_BENCHMARK_JAR=${top_builddir}/src/java/eyedb-benchmark.jar
#BENCHMARK=$1
BENCHMARK=org.eyedb.benchmark.quicktour.eyedb.CreateBenchmark
SCHEMA=${top_srcdir}/src/java/org/eyedb/benchmark/quicktour/eyedb/quicktour/quicktour.odl 
PROPERTIES=eyedb.properties

run_benchmark() {
    CLASSPATH=$EYEDB_BENCHMARK_JAR:$EYEDB_JAR
    CLASSPATH=$CLASSPATH $JAVA org.eyedb.benchmark.framework.Run $BENCHMARK $PROPERTIES
}

. $top_builddir/run/utils/common/functions
. $top_builddir/run/utils/eyedb/functions

read_property $PROPERTIES "DATABASE"
read_property $PROPERTIES "PORT"
stop_server $PORT
set -e
start_server $PORT
delete_db $PORT $DATABASE
create_db $PORT $DATABASE $SCHEMA
run_benchmark
stop_server $PORT

