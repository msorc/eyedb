#!/bin/bash
srcdir=@srcdir@
top_srcdir=@top_srcdir@
top_builddir=@top_builddir@

PROPERTIES=${srcdir}/eyedb.properties
SCHEMA=${top_srcdir}/src/cpp/quicktour/eyedb/quicktour.odl

run_benchmark() {
    $top_builddir/src/cpp/quicktour/eyedb/quicktour --port=$PORT $*
}

. $top_builddir/run/utils/common/functions
. $top_builddir/run/utils/eyedb/functions

read_property $PROPERTIES "eyedb.database" "DATABASE"
read_property $PROPERTIES "eyedb.tcp_port" "PORT"
eyedb_stop_server $PORT
set -e
eyedb_start_server $PORT
eyedb_delete_db $PORT $DATABASE
eyedb_create_db $PORT $DATABASE $SCHEMA
eyedb_resize_shm $PORT $DATABASE
run_benchmark $*
eyedb_stop_server $PORT
