<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd"
[
<!ENTITY eyedb "EyeDB">
<!ENTITY eyedbctl "<command>eyedbctl</command>">
]
>

<book>
  <title>EyeDB Administration Guide</title>

  <chapter id="server">
    <title>Server administration</title>

    <para>
      The first step in &eyedb; administration adresses the server administration: as all existing database management systems, &eyedb; adopts a client/server architecture to provide databases integrity and concurrent accesses. Every database operation requires that a server is up and running; this chapter explains how to start and stop the server, get its status and manage its configuration.
    </para>


    <section>
      <title>The &eyedbctl; command</title>

      <para>
	The &eyedb; server is started, stopped and examined using the &eyedbctl; command. This command is installed in <filename class="directory">/usr/sbin</filename> for standard &eyedb; installations.
      </para>

      <para>
	The &eyedbctl; command has the following syntax:
	<cmdsynopsis>
	  &eyedbctl;<arg choice="plain"><replaceable>command</replaceable></arg><arg choice="plain" rep="repeat">options</arg>
	</cmdsynopsis>
	where <cmdsynopsis><arg choice="plain"><replaceable>command</replaceable></arg></cmdsynopsis> is one of <command>start</command>, <command>stop</command> or <command>status</command>.
      </para>

      <para>
	The following options are the most usefull:
	<itemizedlist>
	  <listitem>
	    <para id="eyedbctl_listen" xreflabel="eyedbctl --listen option">
	      <cmdsynopsis>
		<arg choice="plain">
		  --listen=
		  <arg choice="plain" rep="repeat">
		    <group>
		      <arg choice="plain">
			<arg choice="opt"><replaceable>hostname:</replaceable></arg>
			<arg choice="plain"><replaceable>port</replaceable></arg>
		      </arg>
		      <arg choice="plain">
			<replaceable>unix socket name</replaceable>
		      </arg>
		    </group>
		    ,
		  </arg>
		</arg>
	      </cmdsynopsis>
	      specifies the port the server is listening on. This port can be either a TCP port, specified by a hostname (defaults to "localhost") and a TCP port number, or a Unix socket, specified by a file name.
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      <cmdsynopsis>
		<arg choice="plain">--access-file=<replaceable>file</replaceable></arg>
		</cmdsynopsis> specifies the server access file for network configuration (see <xref linkend="server_network_access_configuration"/>)
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      <cmdsynopsis>
		<arg choice="plain">--server-conf=<replaceable>file</replaceable></arg>
		</cmdsynopsis> specifies the server configuration file (see <xref linkend="server_configuration_file"/>)
	    </para>
	  </listitem>
	  <listitem>
	    <para>
	      <cmdsynopsis>
		<arg choice="plain">--nod</arg>
		</cmdsynopsis> no daemon mode, do not close file descriptors 0, 1 band 2
	    </para>
	  </listitem>
	</itemizedlist>
      </para>

    </section>


    <section>
      <title>Starting and stopping the server</title>

      <section>
	<title>Starting &eyedb; server</title>

	<para>
	  The &eyedb; server is started using the following command:
	  <cmdsynopsis>
	    &eyedbctl;<arg choice="plain">start</arg><arg choice="plain" rep="repeat"><replaceable>options</replaceable></arg>
	  </cmdsynopsis>	  
	</para>

	<example id="eyedbctl-start">
	  <title>&eyedbctl; start</title>
	  <screen><userinput>eyedbctl start</userinput>
Starting EyeDB Server
 Version      V2.8.8
 Compiled     Feb 14 2009 00:16:45
 Architecture i686-pc-linux-gnu
 Program Pid  19433
	  </screen>
	</example>

	<para>
	  By default, the &eyedb; server listens to incoming client connections on 2 ports:
	  <itemizedlist>
	    <listitem><para>a TCP/IP socket bound to port 6240</para></listitem>
	    <listitem><para>a Unix socket bound to file name <filename>/var/lib/eyedb/pipes/eyedbd</filename> for standard installation,  or <filename>PREFIX/var/lib/eyedb/pipes/eyedbd</filename> where <filename>PREFIX</filename> is the installation prefix that has been set during configuration</para></listitem>
	  </itemizedlist>
	</para>

	<para>
	  The listening ports can be set:
	  <itemizedlist>
	    <listitem><para>using &eyedbctl; command options --listen (see <xref linkend="eyedbctl_listen"/>)</para></listitem>
	    <listitem><para>using server configuration file (see <xref linkend="server_configuration_file"/>)</para></listitem>
	  </itemizedlist>
	</para>

	<example id="eyedbctl-start--listen">
	  <title>&eyedbctl; start with --listen option</title>
	  <screen><userinput>eyedbctl start --listen=localhost:10000,/var/tmp/eyedb-socket</userinput>
Starting EyeDB Server
 Version      V2.8.8
 Compiled     Feb 14 2009 00:16:45
 Architecture i686-pc-linux-gnu
 Program Pid  19560
	  </screen>
	</example>

      </section>

      <section>
	<title>Stopping &eyedb; server</title>

	<para>
	  The &eyedb; server is stopped using the following command:
	  <cmdsynopsis>
	    &eyedbctl;<arg choice="plain">stop</arg><arg choice="plain" rep="repeat"><replaceable>options</replaceable></arg>
	  </cmdsynopsis>	  
	</para>

	<example id="eyedbctl-stop">
	  <title>&eyedbctl; stop</title>
	  <screen><userinput>eyedbctl stop</userinput>
Killing EyeDB Server Pid 19433
	  </screen>
	</example>

	<para>
	  If the server was started with the <command>--listen</command> option to set the listening port, the <emphasis>same</emphasis> option must be passed to <command>eyedbctl</command> when stopping the server.
	</para>

	<example id="eyedbctl-stop--listen">
	  <title>&eyedbctl; stop with --listen option</title>
	  <screen>
<userinput>eyedbctl stop</userinput>
No EyeDB Server is running on localhost:6240
<userinput>eyedbctl stop --listen=localhost:10000,/var/tmp/eyedb-socket</userinput>
Killing EyeDB Server Pid 19560
	  </screen>
	</example>

      </section>

    </section>

    <section>
      <title>Getting server information</title>

      <section>
	<title>Getting &eyedb; server status</title>

	<para>
	  The &eyedb; server status can be obtained using the following command:
	  <cmdsynopsis>
	    &eyedbctl;<arg choice="plain">status</arg><arg choice="plain" rep="repeat"><replaceable>options</replaceable></arg>
	  </cmdsynopsis>	  
	  This command will print on its standard output informations about the &eyedb; server currently running: server PID and user, version, listening ports and list of connected clients.
	</para>

	<example id="eyedbctl-status">
	  <title>&eyedbctl; status</title>
	  <screen>
<userinput>eyedbctl status</userinput>

EyeDB Server running since Thu Mar  5 16:08:45 2009

  Version       V2.8.8
  Date          Feb 14 2009 00:16:45
  Architecture  i686-pc-linux-gnu
  Program Pid   19433
  Running Under francois

  Listening on  localhost:6240
                localhost:/home/francois/projects/eyedb/install/var/lib/eyedb/pipes/eyedbd
  Datafile Directory /home/francois/projects/eyedb/install/var/lib/eyedb/db

  No Clients connected.
	  </screen>
	</example>


	<para>
	  Same as for stopping server, if the server was started with the <command>--listen</command> option to set the listening port, the <emphasis>same</emphasis> option must be passed to <command>eyedbctl</command> when getting server status.
	</para>

	<example id="eyedbctl-status--listen">
	  <title>&eyedbctl; status with --listen option</title>
	  <screen>
<userinput>eyedbctl status --listen=localhost:10000,/var/tmp/eyedb-socket</userinput>
EyeDB Server running since Thu Mar  5 16:09:07 2009

  Version       V2.8.8
  Date          Feb 14 2009 00:16:45
  Architecture  i686-pc-linux-gnu
  Program Pid   19560
  Running Under francois

  Listening on  localhost:10000
                localhost:/var/tmp/eyedb-socket
  Datafile Directory /home/francois/projects/eyedb/install/var/lib/eyedb/db

  No Clients connected.
	  </screen>
	</example>

	<para>
	  If clients are connected, the server status will show the list of connected clients, giving for each client a list of open databases.
	</para>

	<example id="eyedb-status-clients">
	  <title>&eyedbctl; status with connected clients</title>
	  <screen>
<userinput>eyedbctl status</userinput>
EyeDB Server running since Thu Mar  5 16:46:55 2009

  Version       V2.8.8
  Date          Feb 14 2009 00:16:45
  Architecture  i686-pc-linux-gnu
  Program Pid   20332
  Running Under francois

  Listening on  localhost:6240
                localhost:/home/francois/projects/eyedb/install/var/lib/eyedb/pipes/eyedbd
  Datafile Directory /home/francois/projects/eyedb/install/var/lib/eyedb/db

  1 Client connected

Client #0
  Connected on Thu Mar  5 16:53:01 2009
  Host:Port    localhost:/home/francois/projects/eyedb/install/var/lib/eyedb/pipes/eyedb
  User Name    francois
  Program Name eyedboql
  Client Pid   20377
  EyeDB Server Pid 20378
  Open Databases 'EYEDBDBM' [mode=sread/local]
                   'EYEDBDBM' [mode=sread/local]
                   'EYEDBDBM' [mode=sread/local]
                   'test' [mode=sread] [userauth=francois]
	  </screen>
	</example>

      </section>

      <section>
	<title>Configuring &eyedb; server logging</title>

	<para>
	</para>

      </section>

    </section>

    <section>
      <title>Server configuration</title>

      <section id="server_configuration_file">
	<title>Server configuration file</title>

	<para>
	</para>

      </section>

      <section>
	<title>Server configuration variables</title>

	<para>
	</para>

      </section>

      <section>
	<title>Environment variables</title>

	<para>
	</para>

      </section>

    </section>

    <section id="server_network_access_configuration">
      <title>Network access server configuration</title>

      <para>
      </para>

    </section>

  </chapter>

</book>
